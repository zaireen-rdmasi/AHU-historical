<div class="p-20 flex flex-col items-center justify-center mb-5">
  <h1 class="text-3xl font-bold text-blue-600">Historical Graph</h1>
  @if (currentData) {
    <p class="text-gray-400">
      Name: <span class="font-semibold text-white">{{ currentData }}</span>
    </p>
  }

  <p>Interactive line charts showing historical trends with per-chart date range controls.</p>
</div>
<div class="card flex flex-wrap items-center justify-center gap-2 mb-5">
  <p-multiselect
    [options]="DataOptions"
    [(ngModel)]="selectedData"
    optionLabel="name"
    placeholder="Select..."
    (onChange)="onChanges($event)"
    [maxSelectedLabels]="5"
    [filter]="false"
    [showToggleAll]="false"
    [disabled]="dataCharts.length !== 0"
    class="w-full md:w-80"
  ></p-multiselect>

  @if (dataCharts.length !== 0) {
    <p-button
      icon="pi pi-times"
      label="Clear"
      [rounded]="true"
      severity="danger"
      size="small"
      (onClick)="dataCharts = []"
    />
  } @else {
    <p-button
      label="Submit"
      severity="info"
      [rounded]="true"
      size="small"
      (onClick)="apiGetData()"
      [disabled]="dataCharts.length !== 0"
    />
  }
</div>
<div class="charts-grid">
  @for (chart of dataCharts; track chart.id) {
    <div class="chart-card">
      <div class="chart-wrapper">
        <div class="chart" echarts [options]="chart.options"></div>
      </div>

      <div class="chart-controls">
        <div class="chart-meta">
          <h2 class="chart-title">{{ chart.config.title }}</h2>
          <span class="chart-unit">{{ chart.config.unit }}</span>
        </div>

        <div class="flex flex-col">
          <div class="flex flex-wrap mb-5">
            <div class="date-inputs">
              <label class="date-field">
                <span>From</span>
                <input
                  type="date"
                  [(ngModel)]="chart.startDate"
                  (change)="onDateChangeRealData(chart)"
                />
              </label>

              <label class="date-field">
                <span>To</span>
                <input
                  type="date"
                  [(ngModel)]="chart.endDate"
                  (change)="onDateChangeRealData(chart)"
                />
              </label>
            </div>
            <!-- <div class="flex flex-wrap sm:w-full md:w-1/2 lg:w-1/2 p-1">
              <span class="w-full">From {{ chart.startDate }}</span>
              <p-datepicker
                [(ngModel)]="chart.startDateShow"
                [iconDisplay]="'input'"
                dateFormat="dd/mm/yy"
                [showIcon]="true"
                inputId="icondisplay"
                [style]="{ width: '100%' }"
                [inputStyle]="{ width: '100%' }"
                (input)="onDateChangeRealData(chart)"
                (onSelect)="onDateChangeRealData2(chart)"
              />
            </div>

            <div class="flex flex-wrap sm:w-full md:w-1/2 lg:w-1/2 p-1">
              <span class="w-full">To {{ chart.endDate }}</span>
              <p-datepicker
                [(ngModel)]="chart.endDateShow"
                [iconDisplay]="'input'"
                dateFormat="dd/mm/yy"
                [showIcon]="true"
                inputId="icondisplay"
                [style]="{ width: '100%' }"
                [inputStyle]="{ width: '100%' }"
                (input)="onDateChangeRealData(chart)"
                (onSelect)="onDateChangeRealData2(chart)"
              />
            </div> -->
          </div>
          <div class="quick-buttons justify-end">
            <button type="button" (click)="setQuickRangeRealData(chart, 30)">30D</button>
            <button type="button" (click)="setQuickRangeRealData(chart, 60)">60D</button>
            <button type="button" (click)="setQuickRangeRealData(chart, 90)">90D</button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
<p-toast />
